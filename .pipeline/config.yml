---
general:
  buildTool: "npm"
service:
  buildToolVersion: "N18"
stages:
  Build:
    mavenExecuteStaticCodeChecks: false
    npmExecuteLint: false
  Container Build:
    # that has no effect:
    stashContent: [ "buildResult" ]
    verbose: true
  Additional Unit Tests:
    npmExecuteScripts: false
  Acceptance:
    cloudFoundryDeploy: false
    npmExecuteEndToEndTests: false
  Compliance:
    sonarExecuteScan: false
  Release:
    cloudFoundryDeploy: false
    tmsUpload: false
steps:
  artifactPrepareVersion:
    versioningType: "cloud_noTag"
  cloudFoundryDeploy:
    mtaDeployParameters: "-f --version-rule ALL"

  # custom additions to make nom build work 
  buildExecute:
    npmRunScripts: [ 'cds-build' ]
    npmInstall: false
    cnbBuild: true
    kubernetesDeploy: true

  pipelineStashFilesAfterBuild:
    stashIncludes:
      buildResult: '**/*'

  # cnbBuild config
  cnbBuild:
    dockerConfigJsonCredentialsId: docker-config
    containerRegistryUrl: concise.common.repositories.cloud.sap
    containerImageTag: latest
    multipleImages:
      - path: gen/srv
        containerImageName: susaas-images/susaas-srv
      - path: gen/api
        containerImageName: susaas-image/usaas-api
      - path: broker
        containerImageName: susaas-image/broker

  # kubernetesDeploy config
  kubernetesDeploy:
    deployTool: helm3
    deploymentName: mh-deployment-01
    chartPath:  charts/sustainable-saas/
    containerRegistryUrl: https://concise.common.repositories.cloud.sap
    kubeConfigFileCredentialsId: kube-config
    imageNames:
      - susaas-image/susaas-srv
      - susaas-image/usaas-api
      - susaas-image/broker
    imageNameTags:
      - latest
      - latest
      - latest

    

